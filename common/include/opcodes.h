/*
 * AshEmu - WoW 2.4.3 Server Emulator (TBC)
 * Copyright (C) 2025 AshEmu Team
 *
 * opcodes.h - Auth and World packet opcodes
 */

#ifndef OPCODES_H
#define OPCODES_H

#include <stdint.h>

/* Auth server opcodes */
typedef enum {
    AUTH_LOGON_CHALLENGE = 0x00,
    AUTH_LOGON_PROOF = 0x01,
    AUTH_REALM_LIST = 0x10
} auth_opcode_t;

/* Auth result codes */
typedef enum {
    AUTH_SUCCESS = 0x00,
    AUTH_FAIL_BANNED = 0x03,
    AUTH_FAIL_UNKNOWN_ACCOUNT = 0x04,
    AUTH_FAIL_INCORRECT_PASSWORD = 0x05,
    AUTH_FAIL_ALREADY_ONLINE = 0x06,
    AUTH_FAIL_NO_TIME = 0x07,
    AUTH_FAIL_DB_BUSY = 0x08,
    AUTH_FAIL_VERSION_INVALID = 0x09,
    AUTH_FAIL_VERSION_UPDATE = 0x0A,
    AUTH_FAIL_SUSPENDED = 0x0C,
    AUTH_SUCCESS_SURVEY = 0x0E,
    AUTH_FAIL_PARENTAL_CONTROL = 0x0F
} auth_result_t;

/* World server opcodes */
typedef enum {
    /* Authentication */
    SMSG_AUTH_CHALLENGE = 0x01EC,
    CMSG_AUTH_SESSION = 0x01ED,
    SMSG_AUTH_RESPONSE = 0x01EE,

    /* Character */
    CMSG_CHAR_ENUM = 0x0037,
    SMSG_CHAR_ENUM = 0x003B,
    CMSG_CHAR_CREATE = 0x0036,
    SMSG_CHAR_CREATE = 0x003A,
    CMSG_CHAR_DELETE = 0x0038,
    SMSG_CHAR_DELETE = 0x003C,
    CMSG_PLAYER_LOGIN = 0x003D,

    /* Login sequence */
    SMSG_LOGIN_VERIFY_WORLD = 0x0236,
    SMSG_ACCOUNT_DATA_TIMES = 0x0209,
    SMSG_TUTORIAL_FLAGS = 0x00FD,
    SMSG_LOGIN_SETTIMESPEED = 0x0042,
    SMSG_INITIAL_SPELLS = 0x012A,
    SMSG_ACTION_BUTTONS = 0x0129,
    SMSG_INITIALIZE_FACTIONS = 0x0122,
    SMSG_INIT_WORLD_STATES = 0x02C2,
    SMSG_BINDPOINTUPDATE = 0x0155,
    SMSG_SET_REST_START = 0x021E,

    /* Updates */
    SMSG_UPDATE_OBJECT = 0x00A9,
    SMSG_DESTROY_OBJECT = 0x00AA,

    /* Movement */
    MSG_MOVE_START_FORWARD = 0x00B5,
    MSG_MOVE_START_BACKWARD = 0x00B6,
    MSG_MOVE_STOP = 0x00B7,
    MSG_MOVE_START_STRAFE_LEFT = 0x00B8,
    MSG_MOVE_START_STRAFE_RIGHT = 0x00B9,
    MSG_MOVE_STOP_STRAFE = 0x00BA,
    MSG_MOVE_JUMP = 0x00BB,
    MSG_MOVE_START_TURN_LEFT = 0x00BC,
    MSG_MOVE_START_TURN_RIGHT = 0x00BD,
    MSG_MOVE_STOP_TURN = 0x00BE,
    MSG_MOVE_START_PITCH_UP = 0x00BF,
    MSG_MOVE_START_PITCH_DOWN = 0x00C0,
    MSG_MOVE_STOP_PITCH = 0x00C1,
    MSG_MOVE_SET_RUN_MODE = 0x00C2,
    MSG_MOVE_SET_WALK_MODE = 0x00C3,
    MSG_MOVE_FALL_LAND = 0x00C9,
    MSG_MOVE_START_SWIM = 0x00CA,
    MSG_MOVE_STOP_SWIM = 0x00CB,
    MSG_MOVE_SET_FACING = 0x00DA,
    MSG_MOVE_SET_PITCH = 0x00DB,
    MSG_MOVE_HEARTBEAT = 0x00EE,

    /* Ping */
    CMSG_PING = 0x01DC,
    SMSG_PONG = 0x01DD,

    /* Time sync */
    SMSG_TIME_SYNC_REQ = 0x0390,
    CMSG_TIME_SYNC_RESP = 0x0391,

    /* Misc */
    CMSG_NAME_QUERY = 0x0050,
    SMSG_NAME_QUERY_RESPONSE = 0x0051,
    CMSG_LOGOUT_REQUEST = 0x004B,
    SMSG_LOGOUT_RESPONSE = 0x004C,
    SMSG_LOGOUT_COMPLETE = 0x004D,

    /* Standstate */
    CMSG_STANDSTATECHANGE = 0x0101,

    /* Set selection */
    CMSG_SET_SELECTION = 0x013D,

    /* Realm split */
    CMSG_REALM_SPLIT = 0x038C,
    SMSG_REALM_SPLIT = 0x038D,

    /* Query */
    CMSG_CREATURE_QUERY = 0x0060,
    CMSG_GAMEOBJECT_QUERY = 0x005E,
    CMSG_ITEM_QUERY_SINGLE = 0x0056
} world_opcode_t;

/* Response codes for world operations */
typedef enum {
    RESPONSE_SUCCESS = 0x00,
    RESPONSE_FAILURE = 0x01,
    RESPONSE_CANCELLED = 0x02,
    RESPONSE_DISCONNECTED = 0x03,
    RESPONSE_FAILED_TO_CONNECT = 0x04,
    RESPONSE_CONNECTED = 0x05,
    RESPONSE_VERSION_MISMATCH = 0x06,

    /* Character creation */
    CHAR_CREATE_SUCCESS = 0x00,
    CHAR_CREATE_ERROR = 0x01,
    CHAR_CREATE_FAILED = 0x02,
    CHAR_CREATE_NAME_IN_USE = 0x03,
    CHAR_CREATE_DISABLED = 0x04,
    CHAR_CREATE_PVP_TEAMS_VIOLATION = 0x05,

    /* Character deletion */
    CHAR_DELETE_SUCCESS = 0x00,
    CHAR_DELETE_FAILED = 0x01,

    /* Character login */
    CHAR_LOGIN_SUCCESS = 0x00,
    CHAR_LOGIN_NO_WORLD = 0x01,

    /* Auth responses */
    WORLD_AUTH_OK = 0x0C,
    WORLD_AUTH_FAILED = 0x0D,
    WORLD_AUTH_REJECT = 0x0E,
    WORLD_AUTH_BAD_SERVER_PROOF = 0x0F,
    WORLD_AUTH_UNAVAILABLE = 0x10,
    WORLD_AUTH_SYSTEM_ERROR = 0x11,
    WORLD_AUTH_BILLING_ERROR = 0x12,
    WORLD_AUTH_BILLING_EXPIRED = 0x13,
    WORLD_AUTH_VERSION_MISMATCH = 0x14,
    WORLD_AUTH_UNKNOWN_ACCOUNT = 0x15,
    WORLD_AUTH_INCORRECT_PASSWORD = 0x16,
    WORLD_AUTH_SESSION_EXPIRED = 0x17,
    WORLD_AUTH_SERVER_SHUTTING_DOWN = 0x18,
    WORLD_AUTH_ALREADY_LOGGING_IN = 0x19,
    WORLD_AUTH_LOGIN_SERVER_NOT_FOUND = 0x1A,
    WORLD_AUTH_WAIT_QUEUE = 0x1B,
    WORLD_AUTH_BANNED = 0x1C,
    WORLD_AUTH_ALREADY_ONLINE = 0x1D,
    WORLD_AUTH_NO_TIME = 0x1E,
    WORLD_AUTH_DB_BUSY = 0x1F,
    WORLD_AUTH_SUSPENDED = 0x20,
    WORLD_AUTH_PARENTAL_CONTROL = 0x21
} response_code_t;

/* Object types */
typedef enum {
    TYPEID_OBJECT = 0,
    TYPEID_ITEM = 1,
    TYPEID_CONTAINER = 2,
    TYPEID_UNIT = 3,
    TYPEID_PLAYER = 4,
    TYPEID_GAMEOBJECT = 5,
    TYPEID_DYNAMICOBJECT = 6,
    TYPEID_CORPSE = 7
} object_type_t;

/* Update types */
typedef enum {
    UPDATETYPE_VALUES = 0,
    UPDATETYPE_MOVEMENT = 1,
    UPDATETYPE_CREATE_OBJECT = 2,
    UPDATETYPE_CREATE_OBJECT2 = 3,
    UPDATETYPE_OUT_OF_RANGE_OBJECTS = 4,
    UPDATETYPE_NEAR_OBJECTS = 5
} update_type_t;

/* Update flags (TBC 2.4.3 format) */
typedef enum {
    UPDATEFLAG_NONE = 0x0000,
    UPDATEFLAG_SELF = 0x0001,
    UPDATEFLAG_TRANSPORT = 0x0002,
    UPDATEFLAG_HAS_ATTACKING_TARGET = 0x0004,
    UPDATEFLAG_LOWGUID = 0x0008,
    UPDATEFLAG_HIGHGUID = 0x0010,
    UPDATEFLAG_LIVING = 0x0020,
    UPDATEFLAG_HAS_POSITION = 0x0040,
    /* TBC additions */
    UPDATEFLAG_VEHICLE = 0x0080,
    UPDATEFLAG_POSITION = 0x0100,
    UPDATEFLAG_ROTATION = 0x0200
} update_flags_t;

/* Movement flags (TBC 2.4.3) */
typedef enum {
    MOVEFLAG_NONE = 0x00000000,
    MOVEFLAG_FORWARD = 0x00000001,
    MOVEFLAG_BACKWARD = 0x00000002,
    MOVEFLAG_STRAFE_LEFT = 0x00000004,
    MOVEFLAG_STRAFE_RIGHT = 0x00000008,
    MOVEFLAG_TURN_LEFT = 0x00000010,
    MOVEFLAG_TURN_RIGHT = 0x00000020,
    MOVEFLAG_PITCH_UP = 0x00000040,
    MOVEFLAG_PITCH_DOWN = 0x00000080,
    MOVEFLAG_WALK_MODE = 0x00000100,
    MOVEFLAG_ONTRANSPORT = 0x00000200,
    MOVEFLAG_LEVITATING = 0x00000400,
    MOVEFLAG_ROOT = 0x00000800,
    MOVEFLAG_FALLING = 0x00001000,
    MOVEFLAG_FALLINGFAR = 0x00002000,
    MOVEFLAG_PENDINGSTOP = 0x00004000,
    MOVEFLAG_PENDINGSTRAFELEFT = 0x00008000,
    MOVEFLAG_PENDINGSTRAFERIGHT = 0x00010000,
    MOVEFLAG_PENDINGFORWARD = 0x00020000,
    MOVEFLAG_PENDINGBACKWARD = 0x00040000,
    MOVEFLAG_PENDINGMOVEMASK = 0x0007C000,
    MOVEFLAG_SWIMMING = 0x00200000,
    MOVEFLAG_SPLINE_ENABLED = 0x00400000,
    MOVEFLAG_CAN_FLY = 0x00800000,
    MOVEFLAG_FLYING = 0x01000000,
    MOVEFLAG_SPLINE_ELEVATION = 0x02000000,
    MOVEFLAG_SPLINE_MARK = 0x04000000,
    MOVEFLAG_WATERWALKING = 0x10000000,
    MOVEFLAG_SAFE_FALL = 0x20000000,
    MOVEFLAG_HOVER = 0x40000000
} movement_flags_t;

/* Check if opcode is a movement opcode */
static inline bool is_movement_opcode(uint16_t opcode) {
    return opcode >= MSG_MOVE_START_FORWARD && opcode <= MSG_MOVE_HEARTBEAT;
}

#endif /* OPCODES_H */
